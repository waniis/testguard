/*!
* WP Grid Builder Map Facet Add-on
*
* @package   WP Grid Builder - Map Facet
* @author    Loïc Blascos
* @link      https://www.wpgridbuilder.com
* @copyright 2019-2021 Loïc Blascos
*
*/
!function(){"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function t(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(t)||function(t,i){if(t){if("string"==typeof t)return e(t,i);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?e(t,i):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function s(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),e}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,a=o(e);if(t){var s=o(this).constructor;i=Reflect.construct(a,arguments,s)}else i=a.apply(this,arguments);return c(this,i)}}var h,p=function(){function e(){i(this,e)}return s(e,[{key:"getMarkerContent",value:function(e){var t=this,i=wpgb_settings.mapFacet.ajaxUrl,a=this.facet.settings.source,s=this.facet.lang,n="".concat(i,"?action=wpgb_map_facet_tooltip&id=").concat(e,"&source=").concat(a).concat(s?"&lang=".concat(s):"");if(this.cache||(this.cache=new Map),this.cache.has(e)){var r=this.cache.get(e);this.setMarkerContent(r,e)}else this.xhr&&this.xhr.abort(),delete this.xhr,this.xhr=new XMLHttpRequest,this.xhr.onload=function(i){return t.onLoad(i,e)},this.xhr.onerror=function(i){return t.onLoad(i,e)},this.xhr.open("GET",n),this.xhr.send()}},{key:"onLoad",value:function(e,t){var i=e.target.responseText,a=JSON.parse(i),s=a.success,n=a.content,r=a.message;s&&this.cache.set(t,n),this.setMarkerContent(s?n:r,t),delete this.xhr}},{key:"setMapPosition",value:function(){this.hasBounds()||(this.hasLocation()?this.updateLocation():this.shouldCenter()?this.centerMarkers():this.canCenter()||this.autoCenterMap())}},{key:"refreshPosition",value:function(){var e=this.facet.queryString,t=this.hasMarkers(),i=this.hasBounds(),a=this.canCenter(),s=this.hasLocation();this.updateMarkers(),this.hasRefreshed||(!s||i?e&&t||!a?i?this.updateBounds():t?this.centerMarkers():t||this.autoCenterMap():this.centerMap():this.updateLocation())}},{key:"setLocation",value:function(e,t,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"km",s=arguments.length>4?arguments[4]:void 0,n=arguments.length>5?arguments[5]:void 0;if(this.circleColor=n||"rgb(54, 138, 252)",this.removeLocation(),e||t){e=parseFloat(e),t=parseFloat(t),i=parseFloat(i),i="mi"===a?1.60934*i:i;var r=.009*(i=Math.min(20037.5,i)+.005),o=Math.max(-90,e-r),l=Math.min(90,e+r),c=Math.max(-180,t-r/Math.cos(e*Math.PI/180)),u=Math.min(180,t+r/Math.cos(e*Math.PI/180));this.location={lat:e,lng:t,rad:i,min:{lat:o,lng:c},max:{lat:l,lng:u}},s&&this.drawLocation()}else this.location=!1}},{key:"hasLocation",value:function(){return this.location&&Object.keys(this.location).length>4}},{key:"updateLocation",value:function(){!this.hasBounds()&&this.centerLocation()}},{key:"hasBounds",value:function(){var e=this.facet.selected;return e&&e.length>=4}},{key:"hasMarkers",value:function(){return this.facet.geoJSON.features.length>0}},{key:"canCenter",value:function(){var e=this.facet.settings,t=e.map_lat,i=e.map_lng;return 0!==t||0!==i}},{key:"shouldCenter",value:function(){return!this.hasBounds()&&this.hasMarkers()&&(!this.canCenter()||this.facet.queryString)}},{key:"getBounds",value:function(){var e=this.facet.bounds;return!(!e||!e.min_lat)&&[{lat:parseFloat(e.min_lat),lng:parseFloat(e.min_lng)},{lat:parseFloat(e.max_lat),lng:parseFloat(e.max_lng)}]}},{key:"getLat",value:function(){var e=this.facet.settings.map_lat;return this.hasBounds()?this.getBoundsLat():parseFloat(e||0)}},{key:"getLng",value:function(){var e=this.facet.settings.map_lng;return this.hasBounds()?this.getBoundsLng():parseFloat(e||0)}},{key:"getSWLat",value:function(){var e=this.facet.selected;return e&&e[0]?parseFloat(e[0]):-90}},{key:"getSWLng",value:function(){var e=this.facet.selected;return e&&e[1]?parseFloat(e[1]):-180}},{key:"getNELat",value:function(){var e=this.facet.selected;return e&&e[2]?parseFloat(e[2]):90}},{key:"getNELng",value:function(){var e=this.facet.selected;return e&&e[3]?parseFloat(e[3]):180}},{key:"getBoundsLat",value:function(){var e=this.getSWLat();return e+(this.getNELat()-e)/2}},{key:"getBoundsLng",value:function(){var e=this.getSWLng();return e+(this.getNELng()-e)/2}},{key:"getZoom",value:function(){var e=this.facet.settings.map_zoom;return this.hasBounds()?parseInt(this.facet.selected[4]):e||2}}]),e}(),m=function(){function e(t,a,s){i(this,e),this.extend(e,google.maps.OverlayView),this.map_=t,this.MARKER_CLUSTER_IMAGE_PATH_="../images/m",this.MARKER_CLUSTER_IMAGE_EXTENSION_="png",this.markers_=[],this.clusters_=[],this.sizes=[53,56,66,78,90],this.styles_=[],this.ready_=!1;var n=s||{};this.zIndex_=n.zIndex||google.maps.Marker.MAX_ZINDEX+1,this.gridSize_=n.gridSize||60,this.minClusterSize_=n.minimumClusterSize||2,this.maxZoom_=n.maxZoom||null,this.styles_=n.styles||[],this.imagePath_=n.imagePath||this.MARKER_CLUSTER_IMAGE_PATH_,this.imageExtension_=n.imageExtension||this.MARKER_CLUSTER_IMAGE_EXTENSION_,this.zoomOnClick_=!0,null!=n.zoomOnClick&&(this.zoomOnClick_=n.zoomOnClick),this.averageCenter_=!1,null!=n.averageCenter&&(this.averageCenter_=n.averageCenter),this.setupStyles_(),this.setMap(t),this.prevZoom_=this.map_.getZoom();var r=this;google.maps.event.addListener(this.map_,"zoom_changed",(function(){var e=r.map_.getZoom(),t=r.map_.minZoom||0,i=Math.min(r.map_.maxZoom||100,r.map_.mapTypes[r.map_.getMapTypeId()].maxZoom);e=Math.min(Math.max(e,t),i),r.prevZoom_!=e&&(r.prevZoom_=e,r.resetViewport())})),google.maps.event.addListener(this.map_,"idle",(function(){r.redraw()})),a&&(a.length||Object.keys(a).length)&&this.addMarkers(a,!1)}return s(e,[{key:"extend",value:function(e,t){return function(e){for(var t in e.prototype)this.prototype[t]=e.prototype[t];return this}.apply(e,[t])}},{key:"onAdd",value:function(){this.setReady_(!0)}},{key:"draw",value:function(){}},{key:"setupStyles_",value:function(){if(!this.styles_.length)for(var e,t=0;e=this.sizes[t];t++)this.styles_.push({url:this.imagePath_+(t+1)+"."+this.imageExtension_,height:e,width:e})}},{key:"fitMapToMarkers",value:function(){for(var e,t=this.getMarkers(),i=new google.maps.LatLngBounds,a=0;e=t[a];a++)i.extend(e.getPosition());this.map_.fitBounds(i)}},{key:"setZIndex",value:function(e){this.zIndex_=e}},{key:"getZIndex",value:function(){return this.zIndex_}},{key:"setStyles",value:function(e){this.styles_=e}},{key:"getStyles",value:function(){return this.styles_}},{key:"isZoomOnClick",value:function(){return this.zoomOnClick_}},{key:"isAverageCenter",value:function(){return this.averageCenter_}},{key:"getMarkers",value:function(){return this.markers_}},{key:"getTotalMarkers",value:function(){return this.markers_.length}},{key:"setMaxZoom",value:function(e){this.maxZoom_=e}},{key:"getMaxZoom",value:function(){return this.maxZoom_}},{key:"calculator_",value:function(e,t){for(var i=0,a=e.length,s=a;0!==s;)s=parseInt(s/10,10),i++;return{text:a,index:i=Math.min(i,t)}}},{key:"setCalculator",value:function(e){this.calculator_=e}},{key:"getCalculator",value:function(){return this.calculator_}},{key:"addMarkers",value:function(e,t){if(e.length)for(var i,a=0;i=e[a];a++)this.pushMarkerTo_(i);else if(Object.keys(e).length)for(var s in e)this.pushMarkerTo_(e[s]);t||this.redraw()}},{key:"pushMarkerTo_",value:function(e){if(e.isAdded=!1,e.draggable){var t=this;google.maps.event.addListener(e,"dragend",(function(){e.isAdded=!1,t.repaint()}))}this.markers_.push(e)}},{key:"addMarker",value:function(e,t){this.pushMarkerTo_(e),t||this.redraw()}},{key:"removeMarker_",value:function(e){var t=-1;if(this.markers_.indexOf)t=this.markers_.indexOf(e);else for(var i,a=0;i=this.markers_[a];a++)if(i==e){t=a;break}return-1!=t&&(e.setMap(null),this.markers_.splice(t,1),!0)}},{key:"removeMarker",value:function(e,t){var i=this.removeMarker_(e);return!(t||!i)&&(this.resetViewport(),this.redraw(),!0)}},{key:"removeMarkers",value:function(e,t){for(var i,a=e===this.getMarkers()?e.slice():e,s=!1,n=0;i=a[n];n++){var r=this.removeMarker_(i);s=s||r}if(!t&&s)return this.resetViewport(),this.redraw(),!0}},{key:"setReady_",value:function(e){this.ready_||(this.ready_=e,this.createClusters_())}},{key:"getTotalClusters",value:function(){return this.clusters_.length}},{key:"getMap",value:function(){return this.map_}},{key:"setMap",value:function(e){this.map_=e}},{key:"getGridSize",value:function(){return this.gridSize_}},{key:"setGridSize",value:function(e){this.gridSize_=e}},{key:"getMinClusterSize",value:function(){return this.minClusterSize_}},{key:"setMinClusterSize",value:function(e){this.minClusterSize_=e}},{key:"getExtendedBounds",value:function(e){var t=this.getProjection(),i=new google.maps.LatLng(e.getNorthEast().lat(),e.getNorthEast().lng()),a=new google.maps.LatLng(e.getSouthWest().lat(),e.getSouthWest().lng()),s=t.fromLatLngToDivPixel(i);s.x+=this.gridSize_,s.y-=this.gridSize_;var n=t.fromLatLngToDivPixel(a);n.x-=this.gridSize_,n.y+=this.gridSize_;var r=t.fromDivPixelToLatLng(s),o=t.fromDivPixelToLatLng(n);return e.extend(r),e.extend(o),e}},{key:"isMarkerInBounds_",value:function(e,t){return t.contains(e.getPosition())}},{key:"clearMarkers",value:function(){this.resetViewport(!0),this.markers_=[]}},{key:"resetViewport",value:function(e){for(var t,i=0;t=this.clusters_[i];i++)t.remove();for(var a,s=0;a=this.markers_[s];s++)a.isAdded=!1,e&&a.setMap(null);this.clusters_=[]}},{key:"repaint",value:function(){var e=this.clusters_.slice();this.clusters_.length=0,this.resetViewport(),this.redraw(),setTimeout((function(){for(var t,i=0;t=e[i];i++)t.remove()}),0)}},{key:"redraw",value:function(){this.createClusters_()}},{key:"distanceBetweenPoints_",value:function(e,t){if(!e||!t)return 0;var i=(t.lat()-e.lat())*Math.PI/180,a=(t.lng()-e.lng())*Math.PI/180,s=Math.sin(i/2)*Math.sin(i/2)+Math.cos(e.lat()*Math.PI/180)*Math.cos(t.lat()*Math.PI/180)*Math.sin(a/2)*Math.sin(a/2);return 6371*(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)))}},{key:"addToClosestCluster_",value:function(e){for(var t,i=4e4,a=null,s=0;t=this.clusters_[s];s++){var n=t.getCenter();if(n){var r=this.distanceBetweenPoints_(n,e.getPosition());r<i&&(i=r,a=t)}}if(a&&a.isMarkerInClusterBounds(e))a.addMarker(e);else{var o=new d(this);o.addMarker(e),this.clusters_.push(o)}}},{key:"createClusters_",value:function(){if(this.ready_)for(var e,t=new google.maps.LatLngBounds(this.map_.getBounds().getSouthWest(),this.map_.getBounds().getNorthEast()),i=this.getExtendedBounds(t),a=0;e=this.markers_[a];a++)!e.isAdded&&this.isMarkerInBounds_(e,i)&&this.addToClosestCluster_(e)}}]),e}(),d=function(){function e(t){i(this,e),this.markerClusterer_=t,this.map_=t.getMap(),this.gridSize_=t.getGridSize(),this.minClusterSize_=t.getMinClusterSize(),this.averageCenter_=t.isAverageCenter(),this.center_=null,this.markers_=[],this.bounds_=null,this.clusterIcon_=new f(this,t.getStyles(),t.getGridSize())}return s(e,[{key:"isMarkerAlreadyAdded",value:function(e){if(this.markers_.indexOf)return-1!=this.markers_.indexOf(e);for(var t,i=0;t=this.markers_[i];i++)if(t==e)return!0;return!1}},{key:"addMarker",value:function(e){if(this.isMarkerAlreadyAdded(e))return!1;if(this.center_){if(this.averageCenter_){var t=this.markers_.length+1,i=(this.center_.lat()*(t-1)+e.getPosition().lat())/t,a=(this.center_.lng()*(t-1)+e.getPosition().lng())/t;this.center_=new google.maps.LatLng(i,a),this.calculateBounds_()}}else this.center_=e.getPosition(),this.calculateBounds_();e.isAdded=!0,this.markers_.push(e);var s=this.markers_.length;if(s<this.minClusterSize_&&e.getMap()!=this.map_&&e.setMap(this.map_),s==this.minClusterSize_)for(var n=0;n<s;n++)this.markers_[n].setMap(null);return s>=this.minClusterSize_&&e.setMap(null),this.updateIcon(),!0}},{key:"getMarkerClusterer",value:function(){return this.markerClusterer_}},{key:"getBounds",value:function(){for(var e,t=new google.maps.LatLngBounds(this.center_,this.center_),i=this.getMarkers(),a=0;e=i[a];a++)t.extend(e.getPosition());return t}},{key:"remove",value:function(){this.clusterIcon_.remove(),this.markers_.length=0,delete this.markers_}},{key:"getSize",value:function(){return this.markers_.length}},{key:"getMarkers",value:function(){return this.markers_}},{key:"getCenter",value:function(){return this.center_}},{key:"calculateBounds_",value:function(){var e=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(e)}},{key:"isMarkerInClusterBounds",value:function(e){return this.bounds_.contains(e.getPosition())}},{key:"getMap",value:function(){return this.map_}},{key:"updateIcon",value:function(){var e=this.map_.getZoom(),t=this.markerClusterer_.getMaxZoom();if(t&&e>t)for(var i,a=0;i=this.markers_[a];a++)i.setMap(this.map_);else if(this.markers_.length<this.minClusterSize_)this.clusterIcon_.hide();else{var s=this.markerClusterer_.getStyles().length,n=this.markerClusterer_.getCalculator()(this.markers_,s);this.clusterIcon_.setCenter(this.center_),this.clusterIcon_.setSums(n),this.clusterIcon_.show()}}}]),e}(),f=function(){function e(t,a,s){i(this,e),t.getMarkerClusterer().extend(e,google.maps.OverlayView),this.styles_=a,this.padding_=s||0,this.cluster_=t,this.center_=null,this.map_=t.getMap(),this.div_=null,this.sums_=null,this.visible_=!1,this.setMap(this.map_)}return s(e,[{key:"triggerClusterClick",value:function(){var e=this.cluster_.getBounds(),t=this.cluster_.getMarkerClusterer();google.maps.event.trigger(t.map_,"clusterclick",this.cluster_),t.isZoomOnClick()&&(this.map_.fitBounds(e),this.map_.setCenter(e.getCenter()))}},{key:"onAdd",value:function(){if(this.div_=document.createElement("DIV"),this.visible_){var e=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(e),this.div_.innerHTML=this.sums_.text}this.getPanes().overlayMouseTarget.appendChild(this.div_);var t=this;google.maps.event.addDomListener(this.div_,"click",(function(){t.triggerClusterClick()}))}},{key:"getPosFromLatLng_",value:function(e){var t=this.getProjection().fromLatLngToDivPixel(e);return t.x-=parseInt(this.width_/2,10),t.y-=parseInt(this.height_/2,10),t}},{key:"draw",value:function(){if(this.visible_){var e=this.getPosFromLatLng_(this.center_);this.div_.style.top=e.y+"px",this.div_.style.left=e.x+"px"}}},{key:"hide",value:function(){this.div_&&(this.div_.style.display="none"),this.visible_=!1}},{key:"show",value:function(){if(this.div_){var e=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(e),this.div_.style.display=""}this.visible_=!0}},{key:"remove",value:function(){this.setMap(null)}},{key:"onRemove",value:function(){this.div_&&this.div_.parentNode&&(this.hide(),this.div_.parentNode.removeChild(this.div_),this.div_=null)}},{key:"setSums",value:function(e){this.sums_=e,this.text_=e.text,this.index_=e.index,this.div_&&(this.div_.innerHTML=e.text),this.useStyle()}},{key:"useStyle",value:function(){var e=Math.max(0,this.sums_.index-1);e=Math.min(this.styles_.length-1,e);var t=this.styles_[e];this.url_=t.url,this.height_=t.height,this.width_=t.width,this.textColor_=t.textColor,this.anchor_=t.anchor,this.textSize_=t.textSize,this.backgroundPosition_=t.backgroundPosition}},{key:"setCenter",value:function(e){this.center_=e}},{key:"createCss",value:function(e){var t=[];t.push("z-index:"+this.cluster_.markerClusterer_.getZIndex()+";"),t.push("background-image:url("+this.url_+");");var i=this.backgroundPosition_?this.backgroundPosition_:"0 0";t.push("background-position:"+i+";"),"object"===l(this.anchor_)?("number"==typeof this.anchor_[0]&&this.anchor_[0]>0&&this.anchor_[0]<this.height_?t.push("height:"+(this.height_-this.anchor_[0])+"px; padding-top:"+this.anchor_[0]+"px;"):t.push("height:"+this.height_+"px; line-height:"+this.height_+"px;"),"number"==typeof this.anchor_[1]&&this.anchor_[1]>0&&this.anchor_[1]<this.width_?t.push("width:"+(this.width_-this.anchor_[1])+"px; padding-left:"+this.anchor_[1]+"px;"):t.push("width:"+this.width_+"px; text-align:center;")):t.push("height:"+this.height_+"px; line-height:"+this.height_+"px; width:"+this.width_+"px; text-align:center;");var a=this.textColor_?this.textColor_:"black",s=this.textSize_?this.textSize_:11;return t.push("cursor:pointer; top:"+e.y+"px; left:"+e.x+"px; color:"+a+"; position:absolute; font-size:"+s+"px; font-family:Arial,sans-serif; font-weight:bold"),t.join("")}}]),e}(),g=m,v=function(e){r(a,e);var t=u(a);function a(e){var s;return i(this,a),(s=t.call(this)).facet=e,s}return s(a,[{key:"emit",value:function(){}},{key:"load",value:function(){var e=this;if((h=document.getElementById("wpgb-gmap-script"))&&h.loaded)this.init();else{if(!h){var t=this.facet.settings.map_api_key;(h=document.createElement("script")).id="wpgb-gmap-script",h.src="".concat("https://maps.googleapis.com/maps/api/js?","key=").concat(t,"&libraries=places"),document.querySelector("head").appendChild(h)}h.addEventListener("load",(function(){return e.init()}))}}},{key:"init",value:function(){var e=this.facet.holder.querySelector(".wpgb-map-facet");this.getOptions(),this.emit("beforeInit"),h.loaded=!0,e.classList.add("wpgb-map-loaded"),this.map=new google.maps.Map(e,this.options),this.popup=new google.maps.InfoWindow({maxWidth:300}),this.setLayers(),this.setClusters(),this.addMarkers(),this.setMapPosition(),this.bindEvents(),this.emit("afterInit")}},{key:"getOptions",value:function(){var e=this.facet.settings;this.options={center:{lat:this.getLat(),lng:this.getLng()},zoom:this.getZoom(),draggable:e.map_dragging,minZoom:e.map_min_zoom||0,maxZoom:e.map_max_zoom||20,mapTypeId:e.map_google_style||"roadmap",zoomControl:e.map_zoom_ctrl,mapTypeControl:e.map_type_ctrl,scaleControl:e.map_scale_ctrl,streetViewControl:e.map_streetview_ctrl,rotateControl:e.map_rotate_ctrl,fullscreenControl:e.map_fullscreen_ctrl,animatedZoom:!1},e.map_scrolling||(this.options.scrollwheel=!1),e.map_poi||(this.options.styles=[{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"off"}]}])}},{key:"setLayers",value:function(){var e=this.facet.settings,t=e.map_transit,i=e.map_traffic,a=e.map_bicycling;t&&(new google.maps.TransitLayer).setMap(this.map),i&&(new google.maps.TrafficLayer).setMap(this.map),a&&(new google.maps.BicyclingLayer).setMap(this.map)}},{key:"setClusters",value:function(){var e=this.facet.settings,t=e.map_cluster_max_zoom,i=e.map_marker_cluster,a=e.map_cluster_size;this.cluster=new g(this.map,[],{minimumClusterSize:i?a||2:999999,imagePath:wpgb_settings.mapFacet.markers,averageCenter:!0,maxZoom:t||14})}},{key:"bindEvents",value:function(){var e=this;window.addEventListener("click",this.onFullScreen.bind(this)),this.popup.addListener("closeclick",(function(){return delete e.popup.marker})),google.maps.event.addListener(this.map,"click",(function(){delete e.popup.marker,e.popup.close()})),this.map.addListener("dragend",(function(){return e.hasMoved=!0})),this.map.addListener("zoom_changed",(function(){return e.hasMoved=!0})),google.maps.event.addDomListener(window,"resize",(function(){return e.setMapPosition()})),this.map.addListener("idle",(function(){!e.fitMarkers&&e.hasMoved&&e.emit("refresh"),delete e.hasMoved,delete e.fitMarkers}))}},{key:"getCoordinates",value:function(){var e=this.map.getBounds();return[e.getSouthWest().lat(),e.getSouthWest().lng(),e.getNorthEast().lat(),e.getNorthEast().lng(),this.map.getZoom()]}},{key:"centerMap",value:function(){this.map.panTo({lat:this.getLat(),lng:this.getLng()}),this.map.setZoom(this.getZoom()),delete this.hasMoved}},{key:"autoCenterMap",value:function(){var e=this.getBounds(),t=new google.maps.LatLngBounds;e&&(this.fitMarkers=!0,t.extend(e[0]),t.extend(e[1]),this.map.setCenter(t.getCenter()),this.map.fitBounds(t))}},{key:"centerMarkers",value:function(){this.fitMarkers=!0,this.map.fitBounds(this.bounds)}},{key:"updateBounds",value:function(){this.fitMarkers=!0,this.map.fitBounds({north:this.getNELat(),south:this.getSWLat(),east:this.getNELng(),west:this.getSWLng()}),this.map.setZoom(this.getZoom()),delete this.hasMoved}},{key:"addMarkers",value:function(){this.markers={},this.bounds=new google.maps.LatLngBounds,this.cluster.clearMarkers(),this.facet.geoJSON.features.map(this.addMarker.bind(this))}},{key:"addMarker",value:function(e){var t=this,i=this.facet.settings,a=e.properties.id,s=e.properties.icon,n=e.geometry.coordinates,r=new google.maps.LatLng(n[1],n[0]),o=new google.maps.Marker({position:r,icon:s});this.bounds.extend(r),this.cluster.addMarker(o),this.markers[a]=o,o.addListener("mouseover",(function(){return t.emit("marker.mouseenter",[e])})),o.addListener("mouseout",(function(){return t.emit("marker.mouseleave",[e])})),o.addListener("click",(function(){return t.emit("marker.click",[e])})),i.map_marker_content&&o.addListener("click",(function(){return t.onMarkerClick(o,a)}))}},{key:"getMarker",value:function(e){return!!this.markers&&this.markers[e]}},{key:"updateMarkers",value:function(){this.popup.close(),this.addMarkers()}},{key:"onMarkerClick",value:function(e,t){this.popup.close(),this.popup.marker!==t?(this.popup.close(),this.popup.setContent('<div class="wpgb-map-marker-loader"></div>'),this.popup.open(this.map,e),this.popup.marker=t,this.getMarkerContent(t)):delete this.popup.marker}},{key:"onFullScreen",value:function(e){var t=e.target,i=t&&t.classList.contains("gm-fullscreen-control"),a=i&&t.closest(".wpgb-facet"),s=a&&a===this.facet.holder;i&&a&&s&&(this.hasMoved=!0)}},{key:"setMarkerContent",value:function(e,t){this.popup.marker===t&&this.popup.setContent(e)}},{key:"drawLocation",value:function(){if(this.map){var e=this.location,t=e.lat,i=e.lng,a=e.rad;this.center=new google.maps.Marker({map:this.map,position:{lat:t,lng:i},clickable:!1,icon:{strokeColor:"rgb(255, 255, 255)",fillColor:this.circleColor,strokeWeight:2,fillOpacity:1,path:google.maps.SymbolPath.CIRCLE,scale:7.5,anchor:new google.maps.Point(0,0)}}),this.circle=new google.maps.Circle({map:this.map,center:{lat:t,lng:i},radius:1e3*a,clickable:!1,strokeColor:this.circleColor,fillColor:this.circleColor,strokeOpacity:.8,strokeWeight:2,fillOpacity:.1})}}},{key:"removeLocation",value:function(){this.circle&&this.circle.setMap(null),this.center&&this.center.setMap(null)}},{key:"centerLocation",value:function(){var e=new google.maps.LatLngBounds;e.extend(this.location.min),e.extend(this.location.max),this.fitMarkers=!0,this.map.fitBounds(e,0)}}]),a}(p),k=document.createElement("script"),_=document.createElement("link"),y=function(e){r(a,e);var t=u(a);function a(e){var s;return i(this,a),(s=t.call(this)).facet=e,s}return s(a,[{key:"emit",value:function(){}},{key:"load",value:function(){var e=this;k.loaded?this.init():(k.addEventListener("load",(function(){return e.init()})),k.src||(_.href="https://api.tiles.mapbox.com/mapbox-gl-js/v1.1.1/mapbox-gl.css",_.rel="stylesheet",k.src="https://api.tiles.mapbox.com/mapbox-gl-js/v1.1.1/mapbox-gl.js",document.querySelector("head").appendChild(_),document.querySelector("head").appendChild(k)))}},{key:"init",value:function(){var e=this.facet.holder.querySelector(".wpgb-map-facet");this.getOptions(e),this.emit("beforeInit"),k.loaded=!0,e.classList.add("wpgb-map-loaded"),mapboxgl.accessToken=this.options.accessToken,this.map=new mapboxgl.Map(this.options),this.popup=new mapboxgl.Popup({closeOnClick:!1}),this.setControls(),this.addMarkers(),this.bindEvents(),this.setMapPosition(),this.hasBounds()&&this.updateBounds(),this.emit("afterInit")}},{key:"getOptions",value:function(e){var t=this.facet.settings;this.options={accessToken:t.map_access_token,container:e,center:{lat:this.getLat(),lng:this.getLng()},scrollZoom:t.map_scrolling,dragPan:t.map_dragging,dragRotate:!1,zoom:this.getZoom(),minZoom:t.map_min_zoom||0,maxZoom:t.map_max_zoom||20,style:t.map_mapbox_style_url||t.map_mapbox_style||"mapbox://styles/mapbox/streets-v11"}}},{key:"setControls",value:function(){var e=this.facet.settings;e.map_fullscreen_ctrl&&this.map.addControl(new mapboxgl.FullscreenControl),e.map_scale_ctrl&&this.map.addControl(new mapboxgl.ScaleControl),e.map_zoom_ctrl&&this.map.addControl(new mapboxgl.NavigationControl),e.map_geo_ctrl&&this.map.addControl(new mapboxgl.GeolocateControl)}},{key:"bindEvents",value:function(){var e=this;this.event=function(){!e.resized&&e.emit("refresh"),delete e.resized,delete e.feature},this.map.on("moveend",this.event),this.resize||(this.map.on("resize",(function(){e.setMapPosition(),e.resized=!0})),this.resize=!0)}},{key:"getCoordinates",value:function(){var e=this.map.getBounds();return[e.getSouthWest().lat,e.getSouthWest().lng,e.getNorthEast().lat,e.getNorthEast().lng,this.map.getZoom()]}},{key:"centerMap",value:function(){this.map.off("moveend",this.event),this.map.panTo([this.getLng(),this.getLat()],{duration:0}),this.map.setZoom(this.getZoom()),this.bindEvents()}},{key:"autoCenterMap",value:function(){var e=this.getBounds(),t=new mapboxgl.LngLatBounds;e&&(t.extend([e[0].lng,e[0].lat]),t.extend([e[1].lng,e[1].lat]),this.map.off("moveend",this.event),this.map.fitBounds(t,{duration:0,padding:50}),this.bindEvents())}},{key:"centerMarkers",value:function(){var e=new mapboxgl.LngLatBounds;this.facet.geoJSON.features.map((function(t){var i=t.geometry;return e.extend(i.coordinates)})),this.map.off("moveend",this.event),this.map.fitBounds(e,{duration:0,padding:50}),this.bindEvents()}},{key:"updateBounds",value:function(){var e=new mapboxgl.LngLatBounds;e.extend([this.getNELng(),this.getNELat()]),e.extend([this.getSWLng(),this.getSWLat()]),this.map.off("moveend",this.event),this.map.fitBounds(e,{duration:0}),this.bindEvents()}},{key:"addMarkers",value:function(){var e=this,t=this.facet.settings;this.map.on("load",(function(){return e.onMapLoad()})),this.map.on("click","cluster",this.onClusterClick.bind(this)),this.map.on("click",(function(t){e.map.queryRenderedFeatures(t.point,{layers:["marker"]}).length||(delete e.popup.marker,e.popup.remove())})),this.popup.on("close",(function(){return delete e.popup.marker})),t.map_marker_content&&this.map.on("click","marker",this.onMarkerClick.bind(this)),this.map.on("mouseenter","marker",(function(t){var i=t.features;return e.emit("marker.mouseenter",[e.feature=i[0]])})),this.map.on("mouseleave","marker",(function(){return e.feature&&e.emit("marker.mouseleave",[e.feature])})),this.map.on("click","marker",(function(t){var i=t.features;return e.emit("marker.click",[i[0]])})),["marker","cluster"].forEach((function(t){e.map.on("mouseenter",t,(function(){return e.map.getCanvas().style.cursor="pointer"})),e.map.on("mouseleave",t,(function(){return e.map.getCanvas().style.cursor=""}))}))}},{key:"getMarker",value:function(e){var t=!1;if(this.map&&this.map.getLayer("marker")){for(var i=this.map.queryRenderedFeatures({layers:["marker"]}),a=0,s=i.length;a<s;a++)if(i[a].properties.id===e){t=i[a];break}return t}}},{key:"updateMarkers",value:function(){var e=this.map.getSource("markers");this.popup.isOpen()&&this.popup.remove(),e&&e.setData(this.facet.geoJSON)}},{key:"onMapLoad",value:function(){var e=this.facet.settings,t=e.map_marker_icon,i=e.map_default_icon,a=t&&t[0]||i;this.emit("loaded"),this.setMarkers(),this.setCluster(),this.map.loadImage(a,this.onImageLoaded.bind(this))}},{key:"onMarkerClick",value:function(e){var t=e.features[0].properties;if(this.popup.marker===t.id)return delete this.popup.marker,void this.popup.remove();this.popup.isOpen()&&this.popup.remove(),this.popup.setLngLat(e.lngLat),this.popup.setHTML('<div class="wpgb-map-marker-loader"></div>'),this.popup.addTo(this.map),this.popup.marker=t.id,this.getMarkerContent(t.id)}},{key:"onClusterClick",value:function(e){var t=this,i=this.map.queryRenderedFeatures(e.point,{layers:["cluster"]}),a=i[0].properties.cluster_id;this.map.getSource("markers").getClusterExpansionZoom(a,(function(e,a){e||t.map.easeTo({center:i[0].geometry.coordinates,zoom:a})}))}},{key:"setMarkers",value:function(){var e=this.facet.settings;this.map.addSource("markers",{type:"geojson",data:this.facet.geoJSON,cluster:!!e.map_marker_cluster,clusterMaxZoom:e.map_cluster_max_zoom||14,clusterRadius:e.map_cluster_radius||50})}},{key:"setCluster",value:function(){this.map.addLayer({id:"cluster",type:"circle",source:"markers",filter:["has","point_count"],paint:{"circle-color":["step",["get","point_count"],"#008cff",10,"#ffbf00",100,"#ff0000",1e3,"#ff00f2",1e4,"#b700ff"],"circle-stroke-opacity":.3,"circle-stroke-width":5,"circle-stroke-color":["step",["get","point_count"],"#008cff",10,"#ffbf00",100,"#ff0000",1e3,"#ff00f2",1e4,"#b700ff"],"circle-radius":["step",["get","point_count"],16,10,18,100,20,1e3,22,1e4,26]}}),this.map.addLayer({id:"cluster-count",type:"symbol",source:"markers",layout:{"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-field":"{point_count}","text-size":11}})}},{key:"onImageLoaded",value:function(e,t){if(e)throw e;this.map.addImage("custom",t),this.setMarkerImage(),this.emit("marker.loaded")}},{key:"setMarkerImage",value:function(){var e=this.facet.settings,t=e.map_marker_icon,i=e.map_marker_height,a=t?(i||40)/t[2]:(i||40)/86;this.map.addLayer({id:"marker",type:"symbol",source:"markers",filter:["!has","point_count"],layout:{"icon-image":"{icon}","icon-size":a,"icon-offset":[0,0],"icon-anchor":"bottom","icon-allow-overlap":!0}})}},{key:"setMarkerContent",value:function(e,t){this.popup.marker===t&&this.popup.setHTML(e)}},{key:"drawLocation",value:function(){if(this.map){var e=this.location,t=e.lat,i=e.lng,a=this.map.getSource("geolocation"),s={type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[i,t]},properties:{id:"geolocation"}}]}};a?a.setData(s.data):this.map.addSource("geolocation",s),this.locationCenter(),this.locationCircle()}}},{key:"removeLocation",value:function(){this.map.getLayer("circle")&&this.map.removeLayer("circle"),this.map.getLayer("center")&&this.map.removeLayer("center")}},{key:"centerLocation",value:function(){var e=new mapboxgl.LngLatBounds;e.extend([this.location.min.lng,this.location.min.lat]),e.extend([this.location.max.lng,this.location.max.lat]),this.map.off("moveend",this.event),this.map.fitBounds(e,{duration:0,padding:50}),this.bindEvents()}},{key:"locationCenter",value:function(){this.map.addLayer({id:"center",source:"geolocation",type:"circle",paint:{"circle-radius":7.5,"circle-opacity":1,"circle-color":this.circleColor,"circle-stroke-color":"rgb(255, 255, 255)","circle-stroke-width":2,"circle-stroke-opacity":1}},this.map.getLayer("marker")?"marker":"")}},{key:"locationCircle",value:function(){var e=1e3*this.location.rad/.075/Math.cos(this.location.lat*Math.PI/180);this.map.addLayer({id:"circle",source:"geolocation",type:"circle",paint:{"circle-radius":{stops:[[0,0],[20,e]],base:2},"circle-opacity":.1,"circle-color":this.circleColor,"circle-stroke-color":this.circleColor,"circle-stroke-width":2,"circle-stroke-opacity":.8}},this.map.getLayer("center")?"center":"")}}]),a}(p),M=document.createElement("script"),C=document.createElement("link"),b={};wpgb_settings.mapFacet&&wpgb_settings.mapFacet.vendors.map((function(e){var t=e.type,i=e.source,a=e.version;return b[t]="".concat(i,"?v=").concat(a)}));var x=function(e){r(a,e);var t=u(a);function a(e){var s;return i(this,a),(s=t.call(this)).facet=e,s}return s(a,[{key:"emit",value:function(){}},{key:"load",value:function(){var e=this;M.loaded?this.init():(M.addEventListener("load",(function(){return e.init()})),M.src||(C.href=b.css,C.rel="stylesheet",M.src=b.js,document.querySelector("head").appendChild(C),document.querySelector("head").appendChild(M)))}},{key:"init",value:function(){var e=this.facet.holder.querySelector(".wpgb-map-facet");this.getOptions(),this.emit("beforeInit"),M.loaded=!0,e&&(e.classList.add("wpgb-map-loaded"),this.map=new L.Map(e,this.options),this.popup=new L.popup({offset:[0,-20],autoPan:!1}),this.setProvider(),this.setClusters(),this.addMarkers(),this.setMapPosition(),this.bindEvents(),this.emit("afterInit"))}},{key:"getOptions",value:function(){var e=this.facet.settings;this.options={center:{lat:this.getLat(),lng:this.getLng()},zoom:this.getZoom(),minZoom:e.map_min_zoom||0,maxZoom:e.map_max_zoom||20,zoomControl:e.map_zoom_ctrl,dragging:e.map_dragging,scrollWheelZoom:e.map_scrolling,gestureHandling:e.map_dragging&&e.map_scrolling,debounceMoveend:!0}}},{key:"setProvider",value:function(){var e=this.facet.settings.map_leaflet_style;for(var t in new L.tileLayer(e.url,e.options).addTo(this.map),e.options.bounds&&this.map.fitBounds(e.options.bounds,{animate:!1}),e.options)this.map.options[t]=e.options[t];this.map.options.minZoom=Math.max(this.options.minZoom,e.options.minZoom||0),this.map.options.maxZoom=Math.min(this.options.maxZoom,e.options.maxZoom||20)}},{key:"setClusters",value:function(){var e=this.facet.settings,t=e.map_cluster_max_zoom,i=e.map_cluster_radius;e.map_marker_cluster&&(this.cluster=new L.MarkerClusterGroup({animate:!1,spiderfyOnMaxZoom:!0,showCoverageOnHover:!1,zoomToBoundsOnClick:!0,disableClusteringAtZoom:t||14,maxClusterRadius:i||80,iconCreateFunction:function(e){var t=e.getChildCount(),i=(t+"").length;return L.divIcon({html:t,className:"leaflet-cluster-icon leaflet-digits-"+i,iconSize:null})}}))}},{key:"bindEvents",value:function(){var e=this,t=this.facet.settings;this.event||(this.event=function(){delete e.popup.marker,e.map.closePopup(),!e.resized&&e.emit("refresh"),delete e.resized},this.layer.on("mouseover",(function(t){var i=t.layer;return e.emit("marker.mouseenter",[i.feature])})),this.layer.on("mouseout",(function(t){var i=t.layer;return e.emit("marker.mouseleave",[i.feature])})),this.layer.on("click",(function(t){var i=t.layer;return e.emit("marker.click",[i.feature])})),t.map_marker_content&&this.layer.on("click",(function(t){var i=t.layer.feature,a=i.properties,s=i.geometry.coordinates;e.popup.marker!==a.id?(e.popup.marker=a.id,e.popup.setLatLng([s[1],s[0]]),e.popup.setContent('<div class="wpgb-map-marker-loader"></div>',{autoPan:!1}),e.popup.openOn(e.map),e.getMarkerContent(a.id)):delete e.popup.marker})),this.map.on("popupclose",(function(){document.activeElement&&document.activeElement.classList.contains("leaflet-marker-icon")||delete e.popup.marker})),this.map.on("movestart",(function(){return delete e.resized})),this.map.on("resize",(function(){e.setMapPosition(),e.resized=!0}))),delete this.popup.marker,delete this.resized,this.map.closePopup(),this.map.on("moveend",this.event)}},{key:"getCoordinates",value:function(){var e=this.map.getBounds();return[e._southWest.lat,e._southWest.lng,e._northEast.lat,e._northEast.lng,this.map.getZoom()]}},{key:"centerMap",value:function(){this.map.off("moveend",this.event),this.map.setView(L.latLng(this.getLat(),this.getLng()),this.getZoom(),{animate:!1,duration:0}),this.bindEvents()}},{key:"autoCenterMap",value:function(){var e=this.getBounds(),t=new L.LatLngBounds;e&&(t.extend([e[0].lat,e[0].lng]),t.extend([e[1].lat,e[1].lng]),this.map.off("moveend",this.event),this.map.fitBounds(t,{animate:!1,duration:0}),this.bindEvents())}},{key:"centerMarkers",value:function(){this.map.off("moveend",this.event),this.map.fitBounds(this.layer.getBounds(),{animate:!1,duration:0}),this.bindEvents()}},{key:"updateBounds",value:function(){var e=L.latLngBounds(L.latLng(this.getSWLat(),this.getSWLng()),L.latLng(this.getNELat(),this.getNELng()));this.map.off("moveend",this.event),this.map.fitBounds(e,{animate:!1,duration:0}),this.bindEvents()}},{key:"updateMarkers",value:function(){this.layer.clearLayers(),this.layer.addData(this.facet.geoJSON),this.cluster?(this.map.removeLayer(this.cluster),this.cluster.clearLayers(),this.cluster.addLayer(this.layer),this.map.addLayer(this.cluster)):this.layer.addTo(this.map)}},{key:"addMarkers",value:function(){this.layer=new L.geoJSON(this.facet.geoJSON,{pointToLayer:this.setIcon.bind(this)}),this.cluster?(this.cluster.addLayer(this.layer),this.cluster.addTo(this.map)):this.layer.addTo(this.map)}},{key:"getMarker",value:function(e){var t={};return this.layer&&this.layer.eachLayer((function(i){e===i.feature.properties.id&&(t=i)})),t}},{key:"setIcon",value:function(e,t){var i=e.properties.icon;return i.url?L.marker(t,{icon:L.icon({iconUrl:i.url,iconSize:[i.size.width,i.size.height],iconAnchor:[i.anchor.x,i.anchor.y]})}):L.marker(t)}},{key:"setMarkerContent",value:function(e,t){this.popup.marker?this.popup.marker===t&&this.popup.setContent(e):this.map.closePopup()}},{key:"drawLocation",value:function(){if(this.map){var e=this.location,t=e.lat,i=e.lng,a=e.rad;this.circle=L.circle([t,i],{interactive:!1,color:this.circleColor,fillColor:this.circleColor,opacity:.8,weight:2,fillOpacity:.1,radius:1e3*a}).addTo(this.map),this.center=L.circleMarker([t,i],{interactive:!1,color:"rgb(255, 255, 255)",fillColor:this.circleColor,weight:2,fillOpacity:1,radius:7.5}).addTo(this.map)}}},{key:"removeLocation",value:function(){this.circle&&this.map.removeLayer(this.circle),this.center&&this.map.removeLayer(this.center)}},{key:"centerLocation",value:function(){var e=new L.LatLngBounds;e.extend(this.location.min),e.extend(this.location.max),this.map.off("moveend",this.event),this.map.fitBounds(e,{animate:!1,duration:0,padding:[0,0]}),this.bindEvents()}}]),a}(p),w="undefined"!=typeof Map&&new Map;function S(e,t,i){var a=e.target,s=t.instance,n=function(e){if(!e||!e.classList.contains("wpgb-card"))return!1;var t=e.className.match(/wpgb-(post|user|term)-\d+/g);return t&&parseInt(t[0].replace(/wpgb-post-|wpgb-user-|wpgb-term-/g,""),10)}(a);if(n){var r=s.getMarker(n);if(r){var o=function(e,t){return e.settings["map_marker_icon".concat(t?"_hover":"")][0]}(t,i);switch(s.type){case"google":var l=r.getIcon();l&&(i&&!l.highlight&&(l.highlight=l.url),l.url=!i&&l.highlight?l.highlight:o,r.setZIndex(i?9999:0),r.setIcon(l));break;case"leaflet":var c=r.getElement&&r.getElement();c&&(c.src=!i&&r.feature&&r.feature.properties&&r.feature.properties.icon&&r.feature.properties.icon.url?r.feature.properties.icon.url:o,c.style.zIndex=i?999:"");break;case"mapbox":s.map.getLayer("marker-hover")&&s.map.setFilter("marker-hover",["==","id",i?r.properties.id:""])}}}}var z=function(e){e.facets.on("render",(function(){if("map"===this.facet.type){if(this.facet.queryString=e.facets.getQueryString(),this.facet.lang=e.options.lang,!this.facet.html)return this.facet.instance=!1,void(this.facet.rendered=!1);if(this.facet.instance)this.facet.instance.map&&(delete this.facet.instance.popup.marker,this.facet.instance.facet=this.facet,this.facet.instance.updateMarkers(),this.facet.instance.refreshPosition(),delete this.facet.instance.hasRefreshed);else{!function(e,t){var i=t.settings,a=i.map_marker_icon,s=i.map_marker_icon_hover;a&&s&&(w.has(t.holder)&&(e.element.removeEventListener("mouseenter",w.get(t.holder).mouseenter,!0),e.element.removeEventListener("mouseleave",w.get(t.holder).mouseleave,!0),w.delete(t.holder)),w.set(t.holder,{mouseenter:function(e){return S(e,t,!0)},mouseleave:function(e){return S(e,t,!1)}}),e.facets.on("map.marker.loaded",(function(){return function(e){var t=e.instance,i=e.settings.map_marker_icon_hover;t.map.loadImage(i[0],(function(e,i){if(e)throw e;t.map.getLayer("marker-hover")||(t.map.addImage("hover",i),t.map.addLayer({id:"marker-hover",type:"symbol",source:"markers",filter:["==","id",""],layout:{"icon-image":"hover","icon-size":t.map.getLayoutProperty("marker","icon-size"),"icon-offset":t.map.getLayoutProperty("marker","icon-offset"),"icon-anchor":t.map.getLayoutProperty("marker","icon-anchor"),"icon-allow-overlap":t.map.getLayoutProperty("marker","icon-allow-overlap")}}))}))}(t)})),e.element.addEventListener("mouseenter",w.get(t.holder).mouseenter,!0),e.element.addEventListener("mouseleave",w.get(t.holder).mouseleave,!0))}(e,this.facet),function(e){var t=e.holder.querySelector('.wpgb-map-pan-to-search input[type="checkbox"]');t&&t.addEventListener("change",(function(e){return e.stopPropagation()}))}(this.facet),this.facet.instance=function(e){var t=e.settings.map_type;if("google"===t)return new v(e);if("leaflet"===t)return new x(e);return new y(e)}(this.facet),this.facet.instance.type=this.facet.settings.map_type,this.facet.instance.emit=function(i,a){"refresh"===i?E.bind(this)(e):e.facets.emit("map.".concat(i),[this.facet.instance].concat(t(a||[])))},this.facet.instance.load();var i=this.facet;e.facets.on("geolocate",(function(){var e;return i.instance&&(e=i.instance).setLocation.apply(e,arguments)}))}this.facet.rendered=!0}}))};function E(e){var t,i,a=this.getCoordinates();(t=this.facet,(i=t.holder.querySelector('.wpgb-map-pan-to-search input[type="checkbox"]'))&&i.checked)&&(e&&e.facets&&(e.facets.emit("change",[this.facet.slug,a]),e.facets.setParams(this.facet.slug,a),e.facets.refresh(),this.hasRefreshed=!0))}function B(e){z(e)}function P(){if(WP_Grid_Builder.on("init",B),WP_Grid_Builder.instances)for(var e in WP_Grid_Builder.instances){var t=WP_Grid_Builder.instances[e];t.element.classList.contains("wpgb-enabled")&&B(t)}}window.WP_Grid_Builder?P():window.addEventListener("wpgb.loaded",(function(){return P()}))}();